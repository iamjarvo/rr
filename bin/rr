#!/usr/bin/env sh

set -e

OPTIND=1

desired_status=0
sleep_duration=1

while getopts "01n:" opt; do
  case "$opt" in
    0)
      desired_status=0
      ;;
    1)
      desired_status=1
      ;;
    n)
      sleep_duration=$OPTARG
      ;;
  esac
done

shift $((OPTIND-1))

while true; do
  date

  set +e
  $@; status=$?
  set -e

  if [ $status = 0 ]; then
    if [ $desired_status = 0 ]; then exit 0; fi
  else
    if [ $desired_status = 1 ]; then exit $status; fi
  fi

  sleep $sleep_duration
done
